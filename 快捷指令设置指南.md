# iOS快捷指令一次性验证设置指南

## 🎯 目标
创建一个智能快捷指令：
- 第一次运行：输入并验证密钥、姓名、日期
- 验证通过后：自动保存设置
- 以后运行：直接使用保存的设置，无需重复输入

## 📱 完整快捷指令流程

### 操作1: 检查是否已保存设置
```
操作类型: 从"文件"中获取值
- 文件: 选择"快捷指令"数据
- 键: "user_settings"
- 允许多个值: 关闭
- 如果没有值: 继续快捷指令
```

### 操作2: 判断是否首次使用
```
操作类型: 如果
- 条件: 从"文件"中获取值 没有任何值
- 如果为真: 执行首次设置流程
- 如果为假: 使用已保存的设置
```

### 操作3: 首次设置流程（在"如果为真"分支中）

#### 3.1 获取密钥
```
操作类型: 请求输入
- 提示: "首次设置：请输入密钥"
- 输入类型: 文本
- 允许多行: 关闭
- 变量名: 输入密钥
```

#### 3.2 获取姓名
```
操作类型: 请求输入
- 提示: "请输入要显示的姓名"
- 默认答案: "ZH** ****AN (만 20세)"
- 输入类型: 文本
- 变量名: 输入姓名
```

#### 3.3 获取日期
```
操作类型: 请求输入
- 提示: "请输入日期 (YYYY.MM.DD)"
- 默认答案: "2025.01.28"
- 输入类型: 文本
- 变量名: 输入日期
```

#### 3.4 验证密钥（测试API请求）
```
操作类型: 获取URL内容
- URL: http://47.116.165.228:3008/api/patch
- 方法: POST
- 标头: Content-Type: application/json
- 请求体: JSON
```

**JSON请求体：**
```json
{
  "key": "输入密钥",
  "name": "输入姓名",
  "date": "输入日期"
}
```

#### 3.5 检查验证结果
```
操作类型: 从输入中获取值
- 获取: 字典值
- 字典: 获取URL内容的结果
- 键: success
- 变量名: 验证结果
```

#### 3.6 判断验证是否成功
```
操作类型: 如果
- 条件: 验证结果 等于 true
- 如果为真: 保存设置并继续
- 如果为假: 显示错误信息并停止
```

#### 3.7 保存设置（验证成功后）
```
操作类型: 设置词典值
- 词典: 新建词典
- 键值对:
  - key: 输入密钥
  - name: 输入姓名  
  - date: 输入日期
  - verified: true
- 变量名: 用户设置
```

```
操作类型: 在"文件"中设置值
- 文件: 选择"快捷指令"数据
- 键: "user_settings"
- 值: 用户设置
```

```
操作类型: 显示通知
- 标题: "设置保存成功"
- 正文: "密钥验证通过，设置已保存！"
```

### 操作4: 使用已保存设置（在"如果为假"分支中）

#### 4.1 加载保存的设置
```
操作类型: 从输入中获取值
- 获取: 字典值
- 字典: 从"文件"中获取值的结果
- 键: key
- 变量名: 保存的密钥
```

```
操作类型: 从输入中获取值
- 获取: 字典值  
- 字典: 从"文件"中获取值的结果
- 键: name
- 变量名: 保存的姓名
```

```
操作类型: 从输入中获取值
- 获取: 字典值
- 字典: 从"文件"中获取值的结果  
- 键: date
- 变量名: 保存的日期
```

### 操作5: 执行最终API请求

```
操作类型: 获取URL内容
- URL: http://47.116.165.228:3008/api/patch
- 方法: POST
- 标头: Content-Type: application/json
- 请求体: JSON
```

**JSON请求体（使用变量）：**
```json
{
  "key": "保存的密钥或输入密钥",
  "name": "保存的姓名或输入姓名",
  "date": "保存的日期或输入日期"
}
```

### 操作6: 提取并执行代码

```
操作类型: 从输入中获取值
- 获取: 字典值
- 字典: 获取URL内容的结果
- 键: simpleCode
- 变量名: 执行代码
```

```
操作类型: 在网页上运行JavaScript
- 网页: 目标网页URL
- JavaScript: patch-client-ios-simple.js的代码
```

## 🎯 运行流程说明

### 首次运行：
1. 检测到无保存设置
2. 要求用户输入密钥、姓名、日期
3. 发送验证请求到服务器
4. 验证成功后保存所有设置
5. 执行网页修改

### 以后运行：
1. 检测到已有保存设置
2. 直接加载保存的设置
3. 立即执行网页修改
4. 无需任何用户输入

## 🔧 重要设置要点

### 变量使用：
- 在JSON中插入变量时，点击变量按钮选择对应变量
- 确保变量名称在整个快捷指令中保持一致

### 错误处理：
- 添加"如果"操作处理验证失败情况
- 提供清晰的错误提示信息

### 数据安全：
- 密钥保存在设备本地
- 可随时在快捷指令中清除保存的数据

## 🚀 额外功能

### 重置设置快捷指令：
如果需要更改设置，可创建一个简单的重置快捷指令：

```
操作类型: 在"文件"中设置值
- 文件: 选择"快捷指令"数据  
- 键: "user_settings"
- 值: [留空删除]
```

这样下次运行主快捷指令时，会重新进入首次设置流程。 