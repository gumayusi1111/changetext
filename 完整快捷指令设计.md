# 完整的网页修改快捷指令设计

## 🎯 单一快捷指令包含所有功能

### 快捷指令名称：「网页内容修改工具」

## 📱 完整操作流程

### 操作1: 检查是否已保存设置
```
操作类型: 从"文件"中获取值
- 文件: 选择"快捷指令"数据
- 键: "user_settings"
- 允许多个值: 关闭
- 如果没有值: 继续快捷指令
```

### 操作2: 显示主菜单
```
操作类型: 从菜单中选取
- 提示: "选择操作"
- 菜单项:
  - "直接使用" (如果有保存设置)
  - "重新设置" 
  - "首次设置" (如果没有保存设置)
  - "取消"
```

### 操作3: 处理菜单选择
```
操作类型: 如果
- 条件: 所选项目 等于 "直接使用"
- 如果为真: 跳转到"使用保存设置"部分
```

```
操作类型: 如果  
- 条件: 所选项目 等于 "重新设置"
- 如果为真: 跳转到"重置并重新设置"部分
```

```
操作类型: 如果
- 条件: 所选项目 等于 "首次设置"  
- 如果为真: 跳转到"首次设置"部分
```

```
操作类型: 如果
- 条件: 所选项目 等于 "取消"
- 如果为真: 停止快捷指令
```

### 操作4: 智能菜单逻辑
```
操作类型: 如果
- 条件: 从"文件"中获取值 有任何值
- 如果为真: 显示包含"直接使用"和"重新设置"的菜单
- 如果为假: 显示"首次设置"菜单
```

## 🔧 各功能分支详细设计

### A. 首次设置分支

#### A1: 获取用户输入
```
操作类型: 请求输入
- 提示: "请输入密钥"
- 输入类型: 文本
- 变量名: 输入密钥
```

```
操作类型: 请求输入
- 提示: "输入要显示的姓名"
- 默认答案: "ZH** ****AN (만 20세)"
- 输入类型: 文本
- 变量名: 输入姓名
```

```
操作类型: 请求输入
- 提示: "输入日期 (YYYY.MM.DD)"
- 默认答案: "2025.01.28"
- 输入类型: 文本
- 变量名: 输入日期
```

#### A2: 验证设置
```
操作类型: 获取URL内容
- URL: http://47.116.165.228:3008/api/patch
- 方法: POST
- 标头: Content-Type: application/json
- 请求体: JSON
```

**验证JSON：**
```json
{
  "key": "输入密钥",
  "name": "输入姓名",
  "date": "输入日期"
}
```

#### A3: 处理验证结果
```
操作类型: 从输入中获取值
- 获取: 字典值
- 字典: 获取URL内容的结果
- 键: success
- 变量名: 验证结果
```

```
操作类型: 如果
- 条件: 验证结果 等于 true
- 如果为真: 保存设置并继续执行
- 如果为假: 显示错误并提供重试选项
```

#### A4: 保存设置
```
操作类型: 设置词典值
- 词典: 新建词典
- 键值对:
  - key: 输入密钥
  - name: 输入姓名
  - date: 输入日期
  - created: 当前日期时间
- 变量名: 用户设置
```

```
操作类型: 在"文件"中设置值
- 文件: 选择"快捷指令"数据
- 键: "user_settings"
- 值: 用户设置
```

```
操作类型: 显示通知
- 标题: "设置保存成功"
- 正文: "验证通过，设置已保存！正在执行修改..."
```

### B. 使用保存设置分支

#### B1: 加载保存的设置
```
操作类型: 从输入中获取值
- 获取: 字典值
- 字典: 从"文件"中获取值的结果
- 键: key
- 变量名: 保存的密钥
```

```
操作类型: 从输入中获取值
- 获取: 字典值
- 字典: 从"文件"中获取值的结果
- 键: name
- 变量名: 保存的姓名
```

```
操作类型: 从输入中获取值
- 获取: 字典值
- 字典: 从"文件"中获取值的结果
- 键: date
- 变量名: 保存的日期
```

### C. 重置并重新设置分支

#### C1: 确认重置
```
操作类型: 显示提醒
- 标题: "确认重置"
- 消息: "将清除所有保存的设置，确定继续吗？"
- 操作: 显示"确定"和"取消"
```

#### C2: 执行重置
```
操作类型: 如果
- 条件: 所选项目 等于 确定
- 如果为真: 清除设置并重新开始
- 如果为假: 返回主菜单
```

```
操作类型: 在"文件"中设置值
- 文件: 选择"快捷指令"数据
- 键: "user_settings"
- 值: [留空删除]
```

```
操作类型: 显示通知
- 标题: "设置已清除"
- 正文: "现在开始重新设置..."
```

然后跳转到首次设置流程。

### D. 最终执行部分（所有分支汇合）

#### D1: 发送最终API请求
```
操作类型: 获取URL内容
- URL: http://47.116.165.228:3008/api/patch
- 方法: POST
- 标头: Content-Type: application/json
- 请求体: JSON
```

**执行JSON（根据来源使用不同变量）：**
```json
{
  "key": "保存的密钥或输入密钥",
  "name": "保存的姓名或输入姓名",
  "date": "保存的日期或输入日期"
}
```

#### D2: 提取并执行代码
```
操作类型: 从输入中获取值
- 获取: 字典值
- 字典: 获取URL内容的结果
- 键: simpleCode
- 变量名: 执行代码
```

```
操作类型: 在网页上运行JavaScript
- 网页: 目标网页URL
- JavaScript: patch-client-ios-simple.js的代码
```

#### D3: 显示结果
```
操作类型: 显示通知
- 标题: "执行完成"
- 正文: "网页内容修改已完成！"
```

## 🎯 用户体验流程

### 首次使用：
```
运行快捷指令 → 显示"首次设置"选项 → 输入信息 → 验证 → 保存 → 执行修改
```

### 后续正常使用：
```
运行快捷指令 → 选择"直接使用" → 立即执行修改
```

### 需要更改设置：
```
运行快捷指令 → 选择"重新设置" → 确认重置 → 重新输入信息 → 执行修改
```

## 💡 智能化特性

1. **自动检测**：自动检测是否有保存设置
2. **动态菜单**：根据设置状态显示不同选项
3. **错误处理**：验证失败时提供重试选项
4. **用户友好**：每个操作都有清晰的提示
5. **一键重置**：不需要单独的重置快捷指令

这样设计的好处：
- ✅ 只需要一个快捷指令
- ✅ 功能完整，包含所有需要的操作
- ✅ 智能判断，用户体验更好
- ✅ 维护简单，只需要管理一个快捷指令 